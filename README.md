# Escape Room Script - README

## Overview

The **Escape Room** script is an interactive bash program designed to test C files against reference executables. The script simulates a timed escape room challenge, where the user must successfully pass tests for all provided C files before the timer runs out. Each test compares the output of the user's compiled executable against a precompiled reference executable.

### Key Features:
1. **Compilation & Testing**: 
   - Compiles user-provided C files with strict flags (`-Wall`, `-Wextra`, `-Werror`).
   - Compares the output of the user executable with the reference executable.

2. **Timed Challenge**:
   - A **30-minute timer** starts when the script begins.
   - Each successful test adds **2 extra minutes** to the timer.
   - If the timer reaches zero, the script displays a "Time's up" message, deletes all generated files, and exits.

3. **Error Handling**:
   - On failed attempts, the script initiates a **1-minute countdown** before retrying.
   - Compilation errors or mismatched outputs are logged in `traces/traces.txt`.

4. **Dynamic Commands**:
   - `grademe`: Tests the current C file against the reference executable.
   - `time`: Displays the remaining time on the timer.

## Prerequisites

Before running the script, **make sure to compile the reference executables** using the provided Makefile.

1. Navigate to the directory containing the `Makefile`.
2. Run the `make` command to compile all reference executables:
   ```bash
   make
   ```

This will create the necessary executables in the `answers` directory.

## Usage

1. Ensure you have the following folder structure:
   ```
   ├── src/                  # Source files for reference executables
   │   ├── ex00.c
   │   ├── ex02.c
   │   ├── ex03.c
   │   ├── ex04.c
   │
   ├── answers/              # Compiled reference executables (generated by Makefile)
   │   ├── ex00
   │   ├── ex02
   │   ├── ex03
   │   ├── ex04
   │
   ├── traces/               # Logs generated by the script
   │
   ├── escape-room.sh        # The main script
   ├── Makefile              # For compiling reference executables
   ```

2. Execute the script:
   ```bash
   ./escape-room.sh
   ```

3. Enter commands when prompted:
   - **`grademe`**: Runs the current test.
   - **`time`**: Displays the time remaining on the timer.

4. Pass all tests to win the challenge!

## Script Functions

### `compile`
- **Purpose**: Compiles a C file into an executable.
- **Arguments**:
  1. Path to the C file to compile.
  2. (Optional) Path for the output executable (`default: "executable"`).
  3. (Optional) Additional C file for compilation.
- **Returns**: 
  - `0` on success.
  - `1` on failure (logs errors to `traces/traces.txt`).

### `tester`
- **Purpose**: Tests a user's C file against a reference executable.
- **Arguments**:
  1. Path to the user's C file.
  2. Path to the reference executable.
  3. (Optional) Path to an input file for arguments.
  4. (Optional) Additional C file for compilation.
- **Behavior**:
  - Compiles the C file.
  - Executes both user and reference executables, optionally passing arguments from the input file.
  - Compares the outputs.
  - Logs errors or mismatches to `traces/traces.txt`.

### `cleanup`
- **Purpose**: Deletes generated files and directories.
- **Arguments**: List of files/directories to delete.

### `timer`
- **Purpose**: Tracks the overall time remaining. Runs in the background.
- **Behavior**:
  - Starts with 30 minutes.
  - Ends the script if time runs out, displaying a "Time's up" message and cleaning up.

### `countdown`
- **Purpose**: Blocks user input for a fixed period (default: 60 seconds) after a failed test.
- **Behavior**:
  - Displays a countdown timer during the block.

### `update_timer`
- **Purpose**: Increments the timer by 2 minutes for each successful test.

## Example Workflow

1. Start the script:
   ```bash
   ./escape-room.sh
   ```

2. Enter `grademe` to test your current C file.

3. If a test passes:
   - The timer increases by 2 minutes.
   - The script proceeds to the next test.

4. If a test fails:
   - A 1-minute countdown blocks input.
   - You can retry after the countdown.

5. Enter `time` to check how much time is left.

6. Pass all tests before time runs out to win. If the timer reaches zero, the script ends with a cleanup and a "Time's up" message.

## Cleaning Up

To manually delete generated files, use:
```bash
make clean
```
This removes the `answers` directory and its contents.